<div id="tools-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

<section class="max-w-7xl mx-auto px-4 py-10">
  <h3 class="text-xl font-semibold mb-4">Notizie AI</h3>
  <div id="feed" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
</section>

<script>
  const toolsURL = "./public/tools.json?_=" + Date.now();
  const newsURL  = "./public/data.json?_=" + Date.now();

  function esc(s){return (s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}

  async function loadAll(){
    try {
      const [toolsRes, newsRes] = await Promise.all([fetch(toolsURL), fetch(newsURL)]);
      const toolsData = await toolsRes.json();
      const newsData  = await newsRes.json();
      renderTools(toolsData.tools || []);
      renderNews(newsData.items || []);
    } catch(err) {
      console.error("Errore nel caricamento:", err);
      document.body.innerHTML = "<p style='padding:40px'>Errore nel caricamento dati.</p>";
    }
  }

  function renderTools(items){
    const grid = document.getElementById("tools-grid");
    if(!grid) return;
    grid.innerHTML = items.map(t => `
      <a href="./tool.html?slug=${encodeURIComponent(t.slug)}" class="group rounded-2xl overflow-hidden border border-zinc-200 hover:shadow-md transition">
        <div class="aspect-[16/9] w-full overflow-hidden bg-zinc-100">
          <img src="${t.cover}" alt="" class="w-full h-full object-cover group-hover:scale-[1.02] transition" />
        </div>
        <div class="p-3">
          <div class="flex items-center gap-2 mb-2">
            <img src="${t.logo}" alt="" class="w-8 h-8 rounded" />
            <div>
              <div class="font-semibold leading-tight">${esc(t.name)}</div>
              <div class="text-xs text-zinc-600">${esc(t.tagline||"")}</div>
            </div>
          </div>
          <p class="text-sm text-zinc-700 line-clamp-2 mb-2">${esc(t.description||"")}</p>
          <div class="flex flex-wrap gap-2">
            ${(t.badges||[]).map(b=>`<span class="text-xs px-2 py-1 rounded-full border border-zinc-200">${esc(b)}</span>`).join("")}
          </div>
        </div>
      </a>
    `).join("");
  }

  function proxy(u){
    if(!u) return "https://via.placeholder.com/180x110?text=AI";
    return "https://images.weserv.nl/?url=" + encodeURIComponent(u) + "&w=360&h=220&fit=cover";
  }

  function renderNews(items){
    const feed = document.getElementById("feed");
    if(!feed) return;
    if(!items.length){ feed.innerHTML = "<p>Nessuna notizia al momento.</p>"; return; }
    feed.innerHTML = items.slice(0,9).map(it => `
      <article class="rounded-2xl overflow-hidden border border-zinc-200">
        <div class="aspect-[16/9] bg-zinc-100">
          <img class="w-full h-full object-cover" src="${proxy(it.image)}" alt="">
        </div>
        <div class="p-3">
          <div class="text-sm text-zinc-500">Hacker News</div>
          <h4 class="font-semibold"><a href="${it.url}" target="_blank" rel="noopener">${esc(it.title)}</a></h4>
          <p class="text-sm text-zinc-700 line-clamp-2">${esc(it.summary||"")}</p>
          <div class="text-xs text-zinc-500 mt-1">${new Date(it.date).toLocaleString("it-IT")}</div>
        </div>
      </article>
    `).join("");
  }

  loadAll();
</script>
